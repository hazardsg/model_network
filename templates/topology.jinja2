---
# -------------------------------------------------------------
# Arista Network Topology
# 
# -------------------------------------------------------------

#https://containerlab.dev/manual/topo-def-file/#name
name: network_model

#https://containerlab.dev/manual/topo-def-file/#prefix
prefix: ""

#https://containerlab.dev/manual/network/#configuring-management-network
mgmt:
  network: mgmt
  ipv4-subnet: 172.100.100.0/24

#https://containerlab.dev/manual/topo-def-file/#topology
topology:

  defaults:
    env:
      INTFTYPE: et

  kinds:
    ceos:
      image: ceos:4.29.1F

  nodes:

###########################################
# Graphite Node                           #
# Provides Topology Graphing and the      #
# ability to connect to nodes in the      #
# topology via a web/ssh session          #
###########################################

    graphite:
      kind: linux
      image: netreplica/graphite
      mgmt-ipv4: 172.100.100.10
      env:
        HOST_CONNECTION: ${SSH_CONNECTION}
      binds:
        - __clabDir__/topology-data.json:/htdocs/default/default.json:ro
        - __clabDir__/ansible-inventory.yml:/htdocs/lab/default/ansible-inventory.yml:ro
      ports:
        - 80:80
      exec:
        - sh -c 'graphite_motd.sh 80'
      labels:
        graph-hide: yes

##############################
# Nodes generated by Script  #
##############################

#https://containerlab.dev/manual/topo-def-file/#nodes
{% for node in nodes %}
    {{node}}:
      kind: ceos
      mgmt-ipv4: 172.100.100.{{loop.index + 10}}
      startup-config: configs/{{node}}.cfg
      binds:
        - override_configs/{{node}}.cfg:/mnt/flash/{{node}}.cfg:ro
      ports:
        - '{{loop.index + 12010}}:22'
        - '{{loop.index + 18010}}:80'
        - '{{loop.index + 14010}}:443'
      exec:
        - Cli -p 15 -c 'copy {{node}}.cfg running-config'
        - Cli -p 15 -c 'write memory'
      labels:
        graph-level: 1
        graph-icon: switch
{% endfor %}


#https://containerlab.dev/manual/topo-def-file/#links
  links:

###############################
# Links Generated by Script   #
###############################
{% for endpoint in endpoints %}
    - endpoints: ["{{endpoint[0]}}", "{{endpoint[1]}}"]
{% endfor %}
